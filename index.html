<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily End Line QI Report</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #9b59b6;
            --light-bg: #f8f9fa;
            --border-color: #dee2e6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header Styles */
        .header {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .title-section h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .date-display {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .admin-section {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .admin-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .admin-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        /* Target Banner */
        .target-banner {
            background: var(--secondary-color);
            color: white;
            padding: 15px 25px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        /* Main Content Layout */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1200px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }
        
        /* Left Panel - Lines and Defects */
        .left-panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 25px;
        }
        
        /* Right Panel - Settings and High Risk */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Defect Types Display */
        .defect-types-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
        }
        
        .card-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .defect-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .defect-tag {
            background: var(--secondary-color);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Lines Container */
        .lines-container {
            margin: 25px 0;
        }
        
        .line-card {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .line-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .line-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .line-name {
            font-weight: 600;
            font-size: 1.2rem;
            color: var(--primary-color);
        }
        
        .defect-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
        }
        
        .defect-input-group {
            background: white;
            padding: 12px 15px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
        }
        
        .defect-label {
            font-weight: 600;
            min-width: 120px;
            color: var(--primary-color);
        }
        
        .percent-input {
            width: 60px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: center;
            margin: 0 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .percent-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .indicator {
            font-size: 1.3rem;
            margin-left: 10px;
        }
        
        .green { color: var(--success-color); }
        .yellow { color: var(--warning-color); }
        .red { color: var(--danger-color); }
        
        /* High Risk Sections */
        .high-risk-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
        }
        
        .high-risk-list {
            margin-top: 15px;
        }
        
        .high-risk-item {
            background: #fff5f5;
            border-left: 4px solid var(--danger-color);
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .high-risk-item.warning {
            background: #fff9e6;
            border-left-color: var(--warning-color);
        }
        
        /* Settings Panel */
        .settings-panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .settings-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .settings-section:last-child {
            margin-bottom: 0;
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        .control-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        
        .control-group input {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .control-group input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        /* Management Sections */
        .management-section {
            background: var(--light-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .management-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .management-controls input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }
        
        .items-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: white;
        }
        
        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .item-row:last-child {
            border-bottom: none;
        }
        
        .item-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }
        
        .edit-btn {
            background: var(--warning-color);
            color: white;
        }
        
        .delete-btn {
            background: var(--danger-color);
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* Action Note */
        .action-note {
            background: linear-gradient(135deg, #e8f4fc 0%, #d1e7f8 100%);
            border-left: 5px solid var(--secondary-color);
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        /* Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Modals */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Paste Modal Tabs */
        .modal-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .modal-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }
        
        .modal-tab.active {
            color: var(--secondary-color);
            border-bottom-color: var(--secondary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1001;
            animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            to {
                opacity: 0;
            }
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
            margin-top: 30px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .defect-inputs {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .management-controls {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="title-section">
                    <h1><i class="fas fa-clipboard-check"></i> Daily End Line Quality Inspection Report</h1>
                    <div class="date-display" id="currentDate">Loading date...</div>
                </div>
                <div class="admin-section">
                    <button class="admin-btn" id="adminLoginBtn">
                        <i class="fas fa-lock"></i> Admin Login
                    </button>
                    <button class="admin-btn" id="logoutBtn" style="display: none;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </header>

        <!-- Target Banner -->
        <div class="target-banner" id="targetText">
            <i class="fas fa-bullseye"></i> Sewing Defects Target 10% Below
        </div>

        <!-- Main Content -->
        <div class="content-wrapper">
            <!-- Left Panel -->
            <div class="left-panel">
                <!-- Defect Types -->
                <div class="defect-types-card">
                    <h2 class="card-title"><i class="fas fa-tags"></i> Active Defect Types</h2>
                    <div class="defect-tags" id="defectTypeList">
                        <!-- Defect types will appear here -->
                    </div>
                </div>

                <!-- Lines Container -->
                <div class="lines-container" id="lines-container">
                    <!-- Line cards will appear here -->
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" id="updateBtn">
                        <i class="fas fa-sync-alt"></i> Update Report
                    </button>
                    <button class="btn btn-success" id="pasteBtn">
                        <i class="fas fa-paste"></i> Paste Percentages
                    </button>
                    <button class="btn btn-warning" id="copyBtn">
                        <i class="fas fa-copy"></i> Copy Report
                    </button>
                </div>

                <!-- Action Note -->
                <div class="action-note">
                    <h3 class="card-title"><i class="fas fa-clipboard-list"></i> Action Note</h3>
                    <p id="actionNoteText">The acceptable defect percentage is below 10%. Necessary corrective measures must be taken promptly to improve the overall quality performance, especially for high-risk lines.</p>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="right-panel">
                <!-- High Risk Sections -->
                <div class="high-risk-card">
                    <h2 class="card-title"><i class="fas fa-exclamation-triangle"></i> High-Risk Lines</h2>
                    
                    <div class="high-risk-section">
                        <h3 style="color: var(--danger-color); margin-bottom: 10px;">
                            <i class="fas fa-fire"></i> Total Defects ><span id="totalRiskValue">16</span>%
                        </h3>
                        <div class="high-risk-list" id="totalHighRiskContainer">
                            <!-- High risk lines for total defects -->
                        </div>
                    </div>

                    <div class="high-risk-section" style="margin-top: 20px;">
                        <h3 style="color: var(--warning-color); margin-bottom: 10px;">
                            <i class="fas fa-cut"></i> Uncut Thread ><span id="uncutRiskValue">10</span>%
                        </h3>
                        <div class="high-risk-list" id="uncutHighRiskContainer">
                            <!-- High risk lines for uncut thread -->
                        </div>
                    </div>
                </div>

                <!-- Settings Panel (Admin Only) -->
                <div class="settings-panel" id="settingsPanel" style="display: none;">
                    <h2 class="card-title"><i class="fas fa-cog"></i> Admin Settings</h2>

                    <!-- Defect Threshold Settings -->
                    <div class="settings-section">
                        <h3 style="margin-bottom: 15px; color: var(--primary-color);">
                            <i class="fas fa-sliders-h"></i> Defect Threshold Settings
                        </h3>
                        <div class="settings-grid">
                            <div class="control-group">
                                <label>Green (ðŸŸ¢) Max %</label>
                                <input type="number" id="greenThreshold" min="0" max="100" value="8">
                            </div>
                            <div class="control-group">
                                <label>Yellow (ðŸŸ¡) Max %</label>
                                <input type="number" id="yellowThreshold" min="0" max="100" value="15">
                            </div>
                            <div class="control-group">
                                <label>Red (ðŸ”´) Min %</label>
                                <input type="number" id="redThreshold" min="0" max="100" value="16">
                            </div>
                            <div class="control-group">
                                <label>High-Risk Min %</label>
                                <input type="number" id="highRiskThreshold" min="0" max="100" value="16">
                            </div>
                        </div>
                    </div>

                    <!-- Uncut Thread Settings -->
                    <div class="settings-section">
                        <h3 style="margin-bottom: 15px; color: var(--primary-color);">
                            <i class="fas fa-cut"></i> Uncut Thread Settings
                        </h3>
                        <div class="settings-grid">
                            <div class="control-group">
                                <label>Green (ðŸŸ¢) Max %</label>
                                <input type="number" id="uncutGreenThreshold" min="0" max="100" value="8">
                            </div>
                            <div class="control-group">
                                <label>Yellow (ðŸŸ¡) Max %</label>
                                <input type="number" id="uncutYellowThreshold" min="0" max="100" value="15">
                            </div>
                            <div class="control-group">
                                <label>Red (ðŸ”´) Min %</label>
                                <input type="number" id="uncutRedThreshold" min="0" max="100" value="16">
                            </div>
                            <div class="control-group">
                                <label>High-Risk %</label>
                                <input type="number" id="uncutHighRiskThreshold" min="0" max="100" value="10">
                            </div>
                        </div>
                    </div>

                    <!-- Text Customization -->
                    <div class="settings-section">
                        <h3 style="margin-bottom: 15px; color: var(--primary-color);">
                            <i class="fas fa-font"></i> Text Customization
                        </h3>
                        <div class="control-group">
                            <label>Target Message</label>
                            <textarea id="targetMessage" rows="3" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; resize: vertical;">Sewing Defects Target 10% Below</textarea>
                        </div>
                        <div class="control-group" style="margin-top: 15px;">
                            <label>Action Note</label>
                            <textarea id="actionNote" rows="4" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; resize: vertical;">The acceptable defect percentage is below 10%. Necessary corrective measures must be taken promptly to improve the overall quality performance, especially for high-risk lines.</textarea>
                        </div>
                    </div>

                    <!-- Management Sections -->
                    <div class="management-section">
                        <h3 style="margin-bottom: 15px; color: var(--primary-color);">
                            <i class="fas fa-tags"></i> Defect Type Management
                        </h3>
                        <div class="management-controls">
                            <input type="text" id="newDefectName" placeholder="Enter new defect type">
                            <button class="btn btn-success" id="addDefectBtn" style="padding: 10px 15px;">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                        <div class="items-list" id="defectList">
                            <!-- Defect types list -->
                        </div>
                    </div>

                    <div class="management-section">
                        <h3 style="margin-bottom: 15px; color: var(--primary-color);">
                            <i class="fas fa-list"></i> Line Management
                        </h3>
                        <div class="management-controls">
                            <input type="text" id="newLineName" placeholder="Enter new line name">
                            <button class="btn btn-success" id="addLineBtn" style="padding: 10px 15px;">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                        <div class="items-list" id="lineList">
                            <!-- Line list -->
                        </div>
                    </div>

                    <!-- Save Button -->
                    <button class="btn btn-primary" id="saveAllBtn" style="width: 100%; margin-top: 20px;">
                        <i class="fas fa-save"></i> Save All Settings
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Quality Inspection System â€¢ Â© 2025 Apparel Manufacturing Co.</p>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <h2 style="text-align: center; margin-bottom: 25px; color: var(--primary-color);">
                <i class="fas fa-lock"></i> Admin Login
            </h2>
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">User ID</label>
                <input type="text" id="username" placeholder="Enter admin user ID" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1rem;">
            </div>
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Password</label>
                <input type="password" id="password" placeholder="Enter password" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1rem;">
            </div>
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-primary" id="loginBtn" style="flex: 1;">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <button class="btn btn-danger" id="modalCancelBtn" style="flex: 1;">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Paste Modal -->
    <div class="modal-overlay" id="pasteModal">
        <div class="modal-content">
            <h2 style="text-align: center; margin-bottom: 25px; color: var(--primary-color);">
                <i class="fas fa-paste"></i> Paste Percentages
            </h2>
            
            <div class="modal-tabs">
                <button class="modal-tab active" data-tab="total">Total Defects</button>
                <button class="modal-tab" data-tab="uncut">Uncut Thread</button>
            </div>
            
            <div class="tab-content active" id="totalTab">
                <p style="margin-bottom: 15px; color: #666;">Paste total defect percentages (one per line):</p>
                <textarea id="pasteAreaTotal" placeholder="Example:&#10;12&#10;15&#10;18&#10;22" rows="12" style="width: 100%; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; font-family: monospace; resize: vertical;"></textarea>
            </div>
            
            <div class="tab-content" id="uncutTab">
                <p style="margin-bottom: 15px; color: #666;">Paste uncut thread percentages (one per line):</p>
                <textarea id="pasteAreaUncut" placeholder="Example:&#10;5&#10;3&#10;8&#10;2" rows="12" style="width: 100%; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; font-family: monospace; resize: vertical;"></textarea>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn btn-success" id="pasteApplyBtn" style="flex: 1;">
                    <i class="fas fa-check"></i> Apply
                </button>
                <button class="btn btn-danger" id="pasteCancelBtn" style="flex: 1;">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification" style="display: none;">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operation completed successfully!</span>
    </div>

    <script>
        // Initialize data storage
        let isAdmin = false;
        
        // Load or initialize data
        function loadData() {
            const savedData = localStorage.getItem('qiReportData');
            if (savedData) {
                return JSON.parse(savedData);
            }
            
            // Default data structure
            return {
                lineData: [
                    { 
                        line: '01', 
                        defects: {
                            'total': 12,
                            'Uncut thread': 5,
                            'Sewing defects': 4,
                            'Fabric defects': 3
                        }
                    },
                    { 
                        line: '02', 
                        defects: {
                            'total': 25,
                            'Uncut thread': 6,
                            'Sewing defects': 15,
                            'Fabric defects': 4
                        }
                    },
                    { 
                        line: '03', 
                        defects: {
                            'total': 8,
                            'Uncut thread': 15,
                            'Sewing defects': 5,
                            'Fabric defects': 2
                        }
                    }
                ],
                defectTypes: ['total', 'Uncut thread', 'Sewing defects', 'Fabric defects'],
                thresholds: {
                    green: 8,
                    yellow: 15,
                    red: 16,
                    highRisk: 16,
                    uncutGreen: 8,
                    uncutYellow: 15,
                    uncutRed: 16,
                    uncutHighRisk: 10
                },
                textContent: {
                    target: "Sewing Defects Target 10% Below",
                    actionNote: "The acceptable defect percentage is below 10%. Necessary corrective measures must be taken promptly to improve the overall quality performance, especially for high-risk lines."
                }
            };
        }

        // Initialize data
        let { lineData, defectTypes, thresholds, textContent } = loadData();

        // DOM Elements
        const currentDateEl = document.getElementById('currentDate');
        const targetTextEl = document.getElementById('targetText');
        const actionNoteTextEl = document.getElementById('actionNoteText');
        const defectTypeListEl = document.getElementById('defectTypeList');
        const linesContainerEl = document.getElementById('lines-container');
        const totalHighRiskContainerEl = document.getElementById('totalHighRiskContainer');
        const uncutHighRiskContainerEl = document.getElementById('uncutHighRiskContainer');
        const totalRiskValueEl = document.getElementById('totalRiskValue');
        const uncutRiskValueEl = document.getElementById('uncutRiskValue');
        
        // Admin elements
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const settingsPanel = document.getElementById('settingsPanel');
        
        // Modal elements
        const loginModal = document.getElementById('loginModal');
        const pasteModal = document.getElementById('pasteModal');
        const notificationEl = document.getElementById('notification');
        const notificationTextEl = document.getElementById('notificationText');

        // Initialize date
        function initializeDate() {
            const now = new Date();
            const formattedDate = `${String(now.getDate()).padStart(2, '0')}-${String(now.getMonth() + 1).padStart(2, '0')}-${now.getFullYear()}`;
            currentDateEl.textContent = formattedDate;
            return formattedDate;
        }

        initializeDate();

        // Save data to localStorage
        function saveDataToStorage() {
            const dataToSave = {
                lineData,
                defectTypes,
                thresholds,
                textContent
            };
            localStorage.setItem('qiReportData', JSON.stringify(dataToSave));
        }

        // Show notification
        function showNotification(message, type = 'success') {
            notificationTextEl.textContent = message;
            notificationEl.style.background = type === 'success' ? '#27ae60' : 
                                             type === 'warning' ? '#f39c12' : '#e74c3c';
            notificationEl.style.display = 'flex';
            setTimeout(() => {
                notificationEl.style.display = 'none';
            }, 3000);
        }

        // Get emoji based on thresholds
        function getEmoji(value, isUncut = false) {
            const green = isUncut ? thresholds.uncutGreen : thresholds.green;
            const yellow = isUncut ? thresholds.uncutYellow : thresholds.yellow;
            const red = isUncut ? thresholds.uncutRed : thresholds.red;
            
            if (value >= 1 && value <= green) return 'ðŸŸ¢';
            if (value > green && value <= yellow) return 'ðŸŸ¡';
            if (value >= red && value <= 100) return 'ðŸ”´';
            return '';
        }

        // Display defect types
        function displayDefectTypes() {
            defectTypeListEl.innerHTML = '';
            defectTypes.forEach(defectType => {
                if (defectType === 'total') return;
                const tag = document.createElement('div');
                tag.className = 'defect-tag';
                tag.innerHTML = `<i class="fas fa-tag"></i> ${defectType}`;
                defectTypeListEl.appendChild(tag);
            });
        }

        // Display lines
        function displayLines() {
            linesContainerEl.innerHTML = '';
            
            lineData.forEach((lineItem, index) => {
                const lineCard = document.createElement('div');
                lineCard.className = 'line-card';
                
                // Line header
                const lineHeader = document.createElement('div');
                lineHeader.className = 'line-header';
                
                const lineName = document.createElement('div');
                lineName.className = 'line-name';
                lineName.textContent = `Line ${lineItem.line}`;
                
                lineHeader.appendChild(lineName);
                
                // Defects inputs
                const defectsInputs = document.createElement('div');
                defectsInputs.className = 'defect-inputs';
                
                defectTypes.forEach(defectType => {
                    const value = lineItem.defects[defectType] || 0;
                    const isUncut = defectType === 'Uncut thread';
                    const emoji = getEmoji(value, isUncut);
                    
                    const inputGroup = document.createElement('div');
                    inputGroup.className = 'defect-input-group';
                    
                    const label = document.createElement('span');
                    label.className = 'defect-label';
                    label.textContent = defectType === 'total' ? 'Total defects' : defectType;
                    
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.className = 'percent-input';
                    input.value = value;
                    input.min = '0';
                    input.max = '100';
                    input.dataset.line = lineItem.line;
                    input.dataset.defect = defectType;
                    
                    const percent = document.createElement('span');
                    percent.className = 'defect-label';
                    percent.textContent = '%';
                    percent.style.minWidth = 'auto';
                    
                    const indicator = document.createElement('span');
                    indicator.className = `indicator ${emoji === 'ðŸŸ¢' ? 'green' : emoji === 'ðŸŸ¡' ? 'yellow' : 'red'}`;
                    indicator.textContent = emoji;
                    
                    inputGroup.appendChild(label);
                    inputGroup.appendChild(input);
                    inputGroup.appendChild(percent);
                    inputGroup.appendChild(indicator);
                    defectsInputs.appendChild(inputGroup);
                });
                
                lineCard.appendChild(lineHeader);
                lineCard.appendChild(defectsInputs);
                linesContainerEl.appendChild(lineCard);
            });
        }

        // Update high-risk sections
        function updateHighRiskSections() {
            totalRiskValueEl.textContent = thresholds.highRisk;
            uncutRiskValueEl.textContent = thresholds.uncutHighRisk;
            
            // Total defects high risk
            totalHighRiskContainerEl.innerHTML = '';
            const totalHighRiskLines = lineData.filter(item => 
                item.defects.total >= thresholds.highRisk
            );
            
            totalHighRiskLines.forEach(item => {
                const riskItem = document.createElement('div');
                riskItem.className = 'high-risk-item';
                const emoji = getEmoji(item.defects.total);
                riskItem.innerHTML = `
                    <span>Line ${item.line} total defects â€“ ${item.defects.total}%${emoji}</span>
                `;
                totalHighRiskContainerEl.appendChild(riskItem);
            });
            
            if (totalHighRiskLines.length === 0) {
                totalHighRiskContainerEl.innerHTML = '<div style="padding: 15px; text-align: center; color: #666;">No high-risk lines for total defects</div>';
            }
            
            // Uncut thread high risk
            uncutHighRiskContainerEl.innerHTML = '';
            const uncutHighRiskLines = lineData.filter(item => 
                item.defects['Uncut thread'] >= thresholds.uncutHighRisk
            );
            
            uncutHighRiskLines.forEach(item => {
                const riskItem = document.createElement('div');
                riskItem.className = 'high-risk-item warning';
                const emoji = getEmoji(item.defects['Uncut thread'], true);
                riskItem.innerHTML = `
                    <span>Line ${item.line} Uncut thread â€“ ${item.defects['Uncut thread']}%${emoji}</span>
                `;
                uncutHighRiskContainerEl.appendChild(riskItem);
            });
            
            if (uncutHighRiskLines.length === 0) {
                uncutHighRiskContainerEl.innerHTML = '<div style="padding: 15px; text-align: center; color: #666;">No high-risk lines for uncut thread</div>';
            }
        }

        // Update text content
        function updateTextContent() {
            targetTextEl.innerHTML = `<i class="fas fa-bullseye"></i> ${textContent.target}`;
            actionNoteTextEl.textContent = textContent.actionNote;
        }

        // Update defect list in admin panel
        function updateDefectList() {
            const defectListEl = document.getElementById('defectList');
            defectListEl.innerHTML = '';
            
            defectTypes.forEach((defectType, index) => {
                if (defectType === 'total') return;
                
                const itemRow = document.createElement('div');
                itemRow.className = 'item-row';
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = defectType;
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'item-actions';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'action-btn edit-btn';
                editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                editBtn.onclick = () => {
                    const newName = prompt('Edit defect type name:', defectType);
                    if (newName && newName.trim() && newName !== defectType) {
                        if (defectTypes.includes(newName)) {
                            showNotification('Defect type already exists!', 'warning');
                            return;
                        }
                        
                        // Update in defectTypes
                        defectTypes[index] = newName;
                        
                        // Update in all line data
                        lineData.forEach(line => {
                            if (line.defects[defectType] !== undefined) {
                                line.defects[newName] = line.defects[defectType];
                                delete line.defects[defectType];
                            }
                        });
                        
                        updateDefectList();
                        displayDefectTypes();
                        displayLines();
                        updateHighRiskSections();
                        saveDataToStorage();
                        showNotification('Defect type updated successfully!');
                    }
                };
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'action-btn delete-btn';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.onclick = () => {
                    if (defectTypes.length <= 2) {
                        showNotification('You must have at least one defect type!', 'warning');
                        return;
                    }
                    
                    if (confirm(`Are you sure you want to delete "${defectType}"?`)) {
                        // Remove from defectTypes
                        defectTypes.splice(index, 1);
                        
                        // Remove from all line data
                        lineData.forEach(line => {
                            delete line.defects[defectType];
                        });
                        
                        updateDefectList();
                        displayDefectTypes();
                        displayLines();
                        updateHighRiskSections();
                        saveDataToStorage();
                        showNotification('Defect type deleted successfully!');
                    }
                };
                
                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);
                itemRow.appendChild(nameSpan);
                itemRow.appendChild(actionsDiv);
                defectListEl.appendChild(itemRow);
            });
        }

        // Update line list in admin panel
        function updateLineList() {
            const lineListEl = document.getElementById('lineList');
            lineListEl.innerHTML = '';
            
            lineData.forEach((lineItem, index) => {
                const itemRow = document.createElement('div');
                itemRow.className = 'item-row';
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = `Line ${lineItem.line}`;
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'item-actions';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'action-btn edit-btn';
                editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                editBtn.onclick = () => {
                    const newName = prompt('Edit line name:', lineItem.line);
                    if (newName && newName.trim() && newName !== lineItem.line) {
                        if (lineData.some(line => line.line === newName)) {
                            showNotification('Line name already exists!', 'warning');
                            return;
                        }
                        
                        lineItem.line = newName;
                        updateLineList();
                        displayLines();
                        updateHighRiskSections();
                        saveDataToStorage();
                        showNotification('Line name updated successfully!');
                    }
                };
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'action-btn delete-btn';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.onclick = () => {
                    if (lineData.length <= 1) {
                        showNotification('You must have at least one line!', 'warning');
                        return;
                    }
                    
                    if (confirm(`Are you sure you want to delete "Line ${lineItem.line}"?`)) {
                        lineData.splice(index, 1);
                        updateLineList();
                        displayLines();
                        updateHighRiskSections();
                        saveDataToStorage();
                        showNotification('Line deleted successfully!');
                    }
                };
                
                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);
                itemRow.appendChild(nameSpan);
                itemRow.appendChild(actionsDiv);
                lineListEl.appendChild(itemRow);
            });
        }

        // Parse pasted percentages
        function parsePastedPercentages(text) {
            const cleanedText = text
                .replace(/[â€‹â€¯â€‰]/g, ' ')
                .replace(/[â„‰]/g, '%')
                .replace(/[^\d%\n\t,\. ]/g, '')
                .trim();
            
            const values = cleanedText.split(/[\n,\t ]+/)
                .map(val => val.trim())
                .filter(val => val !== '')
                .map(val => {
                    if (val.includes('%')) {
                        val = val.replace('%', '');
                    }
                    const num = parseFloat(val);
                    return isNaN(num) ? null : Math.min(100, Math.max(0, Math.round(num)));
                })
                .filter(val => val !== null);
            
            return values;
        }

        // Generate copy text
        function generateCopyText() {
            let text = `ðŸ“… Daily End Line QI Report â€“ ${initializeDate()}\n`;
            text += `ðŸŽ¯ ${textContent.target}\n\n`;
            text += `Quality Performance by Line:\n\n`;
            
            lineData.forEach(item => {
                let lineText = `Line ${item.line} total defects â€“ ${item.defects.total}% ${getEmoji(item.defects.total)}`;
                
                defectTypes.filter(d => d !== 'total').forEach(defectType => {
                    const value = item.defects[defectType] || 0;
                    const isUncut = defectType === 'Uncut thread';
                    lineText += ` ${defectType} ${value}%${getEmoji(value, isUncut)}`;
                });
                
                text += lineText + '\n';
            });
            
            // Add high-risk sections
            const totalHighRiskLines = lineData.filter(item => item.defects.total >= thresholds.highRisk);
            const uncutHighRiskLines = lineData.filter(item => item.defects['Uncut thread'] >= thresholds.uncutHighRisk);
            
            if (totalHighRiskLines.length > 0) {
                text += `\nðŸ”´ High-Risk Lines (Total Defects >${thresholds.highRisk}%):\n`;
                totalHighRiskLines.forEach(item => {
                    text += `Line ${item.line} total defects â€“ ${item.defects.total}%${getEmoji(item.defects.total)}\n`;
                });
            }
            
            if (uncutHighRiskLines.length > 0) {
                text += `\nðŸ”´ High-Risk Lines (Uncut Thread >${thresholds.uncutHighRisk}%):\n`;
                uncutHighRiskLines.forEach(item => {
                    text += `Line ${item.line} Uncut thread â€“ ${item.defects['Uncut thread']}%${getEmoji(item.defects['Uncut thread'], true)}\n`;
                });
            }
            
            text += `\nðŸ“Œ Action Note:\n`;
            text += `${textContent.actionNote}`;
            
            return text;
        }

        // Initialize the display
        function initializeDisplay() {
            displayDefectTypes();
            displayLines();
            updateHighRiskSections();
            updateTextContent();
        }

        // Event Listeners
        document.getElementById('updateBtn').addEventListener('click', () => {
            const inputs = document.querySelectorAll('.percent-input');
            inputs.forEach(input => {
                const line = input.dataset.line;
                const defect = input.dataset.defect;
                const percent = parseInt(input.value) || 0;
                const lineItem = lineData.find(item => item.line === line);
                if (lineItem) {
                    lineItem.defects[defect] = percent;
                }
            });
            
            displayLines();
            updateHighRiskSections();
            saveDataToStorage();
            showNotification('Report updated successfully!');
        });

        document.getElementById('copyBtn').addEventListener('click', () => {
            const copyText = generateCopyText();
            navigator.clipboard.writeText(copyText).then(() => {
                showNotification('Report copied to clipboard!');
            }).catch(err => {
                showNotification('Failed to copy report!', 'warning');
            });
        });

        document.getElementById('pasteBtn').addEventListener('click', () => {
            const totalTextarea = document.getElementById('pasteAreaTotal');
            const uncutTextarea = document.getElementById('pasteAreaUncut');
            
            totalTextarea.value = lineData.map(line => line.defects.total).join('\n');
            uncutTextarea.value = lineData.map(line => line.defects['Uncut thread'] || 0).join('\n');
            
            pasteModal.style.display = 'flex';
        });

        // Login functionality
        adminLoginBtn.addEventListener('click', () => {
            loginModal.style.display = 'flex';
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            isAdmin = false;
            settingsPanel.style.display = 'none';
            adminLoginBtn.style.display = 'flex';
            logoutBtn.style.display = 'none';
            showNotification('Logged out successfully!');
        });

        document.getElementById('loginBtn').addEventListener('click', () => {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'admin' && password === '127627') {
                isAdmin = true;
                settingsPanel.style.display = 'block';
                adminLoginBtn.style.display = 'none';
                logoutBtn.style.display = 'flex';
                loginModal.style.display = 'none';
                
                // Populate admin settings
                document.getElementById('greenThreshold').value = thresholds.green;
                document.getElementById('yellowThreshold').value = thresholds.yellow;
                document.getElementById('redThreshold').value = thresholds.red;
                document.getElementById('highRiskThreshold').value = thresholds.highRisk;
                document.getElementById('uncutGreenThreshold').value = thresholds.uncutGreen;
                document.getElementById('uncutYellowThreshold').value = thresholds.uncutYellow;
                document.getElementById('uncutRedThreshold').value = thresholds.uncutRed;
                document.getElementById('uncutHighRiskThreshold').value = thresholds.uncutHighRisk;
                document.getElementById('targetMessage').value = textContent.target;
                document.getElementById('actionNote').value = textContent.actionNote;
                
                updateDefectList();
                updateLineList();
                
                showNotification('Admin login successful!');
            } else {
                showNotification('Invalid credentials!', 'warning');
            }
        });

        // Modal cancel buttons
        document.getElementById('modalCancelBtn').addEventListener('click', () => {
            loginModal.style.display = 'none';
        });

        document.getElementById('pasteCancelBtn').addEventListener('click', () => {
            pasteModal.style.display = 'none';
        });

        // Paste modal tabs
        document.querySelectorAll('.modal-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}Tab`).classList.add('active');
            });
        });

        // Apply paste
        document.getElementById('pasteApplyBtn').addEventListener('click', () => {
            const activeTab = document.querySelector('.modal-tab.active');
            const defectType = activeTab.dataset.tab === 'total' ? 'total' : 'Uncut thread';
            
            const textarea = document.getElementById(`pasteArea${activeTab.dataset.tab.charAt(0).toUpperCase() + activeTab.dataset.tab.slice(1)}`);
            const percentages = parsePastedPercentages(textarea.value);
            
            if (percentages.length === 0) {
                showNotification('No valid percentages found!', 'warning');
                return;
            }
            
            percentages.forEach((percent, index) => {
                if (index < lineData.length) {
                    lineData[index].defects[defectType] = percent;
                }
            });
            
            displayLines();
            updateHighRiskSections();
            saveDataToStorage();
            pasteModal.style.display = 'none';
            showNotification(`${percentages.length} ${defectType} percentages applied!`);
        });

        // Add defect type
        document.getElementById('addDefectBtn').addEventListener('click', () => {
            const newDefectName = document.getElementById('newDefectName').value.trim();
            
            if (!newDefectName) {
                showNotification('Please enter a defect type name!', 'warning');
                return;
            }
            
            if (defectTypes.includes(newDefectName)) {
                showNotification('Defect type already exists!', 'warning');
                return;
            }
            
            defectTypes.push(newDefectName);
            lineData.forEach(line => {
                line.defects[newDefectName] = 0;
            });
            
            document.getElementById('newDefectName').value = '';
            updateDefectList();
            displayDefectTypes();
            displayLines();
            saveDataToStorage();
            showNotification(`Defect type "${newDefectName}" added!`);
        });

        // Add line
        document.getElementById('addLineBtn').addEventListener('click', () => {
            const newLineName = document.getElementById('newLineName').value.trim();
            
            if (!newLineName) {
                showNotification('Please enter a line name!', 'warning');
                return;
            }
            
            if (lineData.some(line => line.line === newLineName)) {
                showNotification('Line name already exists!', 'warning');
                return;
            }
            
            const newLine = { line: newLineName, defects: {} };
            defectTypes.forEach(defectType => {
                newLine.defects[defectType] = 0;
            });
            
            lineData.push(newLine);
            document.getElementById('newLineName').value = '';
            updateLineList();
            displayLines();
            updateHighRiskSections();
            saveDataToStorage();
            showNotification(`Line "${newLineName}" added!`);
        });

        // Save all settings
        document.getElementById('saveAllBtn').addEventListener('click', () => {
            // Update thresholds
            thresholds.green = parseInt(document.getElementById('greenThreshold').value) || 8;
            thresholds.yellow = parseInt(document.getElementById('yellowThreshold').value) || 15;
            thresholds.red = parseInt(document.getElementById('redThreshold').value) || 16;
            thresholds.highRisk = parseInt(document.getElementById('highRiskThreshold').value) || 16;
            thresholds.uncutGreen = parseInt(document.getElementById('uncutGreenThreshold').value) || 8;
            thresholds.uncutYellow = parseInt(document.getElementById('uncutYellowThreshold').value) || 15;
            thresholds.uncutRed = parseInt(document.getElementById('uncutRedThreshold').value) || 16;
            thresholds.uncutHighRisk = parseInt(document.getElementById('uncutHighRiskThreshold').value) || 10;
            
            // Update text content
            textContent.target = document.getElementById('targetMessage').value;
            textContent.actionNote = document.getElementById('actionNote').value;
            
            // Refresh displays
            displayLines();
            updateHighRiskSections();
            updateTextContent();
            saveDataToStorage();
            
            showNotification('All settings saved successfully!');
        });

        // Initialize the application
        initializeDisplay();
    </script>
</body>
</html>
